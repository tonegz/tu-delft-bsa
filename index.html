<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSA Calculator: Aerospace Engineering at TU Delft</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0.25rem 2rem 2rem 2rem;
      background: #f6f8fb;
      color: #1f2937;
      position: relative;
    }

    .logo {
      position: absolute;
      top: 0rem;
      right: 2rem;
      max-width: 200px;
      max-height: 100px;
      width: auto;
      height: auto;
      z-index: -1;
    }
    h1 { margin-bottom: 0.25rem; }
    .subtitle { color: #6b7280; margin-bottom: 1.5rem; }
    .container { max-width: 950px; margin: 0 auto; }

    .progress-card {
      background: white;
      padding: 1.25rem 1.5rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
    }

    .progress-bar {
      position: relative;
      height: 22px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: visible; /* allow marker to extend above/below */
      margin-top: 0.75rem;
    }

    .partial-fill {
      position: absolute;
      top: 0;
      height: 100%;
      width: 0%;
      left: 0%;
      transition: width 0.3s ease, left 0.3s ease;
      background: #F3B07A; /* subtle orange for partial module credits */
      border-radius: 0; /* straight edges */
      z-index: 1;
    }

    .progress-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      transition: width 0.3s ease, background 0.3s ease, left 0.3s ease;
      z-index: 2;
    }

    .threshold-marker {
      position: absolute;
      left: 75%;
      top: -10px;
      bottom: -10px;
      width: 2px;
      background: #374151;
      z-index: 10;
      border-radius: 2px;
    }

    .threshold-label {
      position: absolute;
      left: 75%;
      top: -1.4rem;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #374151;
      z-index: 11;
      background: white;
      padding: 0 6px;
    }

    .status {
      margin-top: 0.5rem;
    }

    .status.pass { color: #059669; }
    .status.fail { color: #2563eb; }

    .partial-note {
      color: #9ca3af;
      margin-left: 0.6rem;
      font-size: 0.95rem;
      display: inline-block;
    }

    .grid {
      display: grid;
      grid-template-columns: auto 1fr auto repeat(4, 36px) auto;
      gap: 0.75rem 0.75rem;
      align-items: center;
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }

    .grid-header {
      font-weight: 600;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.5rem;
      text-align: center;
    }

    .grid-header.left { text-align: left; }

    .course { display: contents; }

    .course-name {
      cursor: pointer;
      user-select: none;
    }

    .ec {
      text-align: center;
      color: #9ca3af;
      transition: color 0.2s ease, font-weight 0.2s ease;
    }

    .ec.passed {
      color: #111827;
      font-weight: 600;
    }

    .ec.partial {
      color: #d97706;
      font-weight: 400;
    }

    input[type="checkbox"] {
      transform: scale(1.15);
      cursor: pointer;
    }

    .quarter {
      height: 26px;
      border-radius: 6px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quarter.active {
      background: #bbf7d0; /* lighter green */
      color: #065f46;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: auto 1fr auto auto;
        gap: 0.75rem 0.75rem;
      }

      .grid-header:nth-child(4),
      .grid-header:nth-child(5),
      .grid-header:nth-child(6),
      .grid-header:nth-child(7) {
        display: none;
      }

      .quarter {
        display: none;
      }

      .full-title {
        display: none;
      }
    }

    @media (max-width: 700px) {
      .logo {
        opacity: 0.85;
        transform: scale(0.8);
        transform-origin: top right;
      }
    }

    @media (max-width: 620px) {
      .logo {
        opacity: 0.7;
      }
    }

    @media (max-width: 540px) {
      .logo {
        opacity: 0.5;
      }
      .threshold-label { display: none; }
      .partial-note { display: none; }
    }

    /* Very small screens: reduce opacity, scale down, and shift above the viewport */
    @media (max-width: 480px) {
      .logo {
        opacity: 0.3;
        transform: translateY(-20%) scale(0.33);
        transform-origin: top right;
        right: 0;
        top: 0; /* keep anchored at the very top before translate */
        margin: 0;
        padding: 0;
        max-width: none;
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <img src="logo_rgb.svg" alt="TU Delft Logo" class="logo" />
  <div class="container">
    <h1>BSA Calculator<span class="full-title">: Aerospace Engineering</span></h1>
    <div class="subtitle">You must obtain at least 45 credits in the first academic year, <a href="https://www.tudelft.nl/en/student/my-study-me/rules-guidelines-and-participation/binding-recommendation-on-continuation-of-studies">or else</a></div>

    <div class="progress-card">
      <div><strong>Total ECs collected:</strong> <span id="totalEC">0</span> / 60<span id="partialText" class="partial-note"></span></div>
      <div class="progress-bar">
        <div class="threshold-label">45 EC</div>
        <div class="threshold-marker"></div>
        <div class="partial-fill" id="partialFill"></div>
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="status fail" id="statusText"></div>
    </div>

    <div class="grid" id="courseGrid">
      <div></div>
      <div class="grid-header left">Course</div>
      <div class="grid-header">EC</div>
      <div class="grid-header">Q1</div>
      <div class="grid-header">Q2</div>
      <div class="grid-header">Q3</div>
      <div class="grid-header">Q4</div>
      <div></div>
    </div>

  <script>
    const BSA_THRESHOLD = 45;
    const TOTAL_EC = 60;

    const courses = [
      { name: "Introduction to AE I", ec: 5, q: [1] },
      { name: "Statics", ec: 4, q: [1] },
      { name: "Calculus I", ec: 6, q: [1,2] },
      { name: "Exploring Aerospace Engineering", ec: 3, q: [1,2] },
      { name: "Engineering Drawing", ec: 2, q: [1,2] },
      { name: "Introduction to AE II", ec: 4, q: [2] },
      { name: "Dynamics", ec: 3, q: [2] },
      { name: "Aerospace Materials", ec: 3, q: [2] },
      { name: "Aerospace Mechanics of Materials", ec: 3, q: [3] },
      { name: "Calculus II", ec: 5, q: [3] },
      { name: "Physics", ec: 6, q: [3,4] },
      { name: "Design and Construction", ec: 5, q: [3,4] },
      { name: "Aerospace Design and Systems Engineering Elements", ec: 4, q: [3,4] },
      { name: "Programming and Scientific Computing in Python for AE1", ec: 2, q: [4] },
      { name: "Linear Algebra", ec: 5, q: [4] }
    ];

    // Modules: pairs that must be entirely passed to count their ECs
    const modules = [
      ["Aerospace Materials","Aerospace Mechanics of Materials"],
      ["Introduction to AE I","Introduction to AE II"],
      ["Exploring Aerospace Engineering","Engineering Drawing"],
      ["Statics","Dynamics"],
      ["Design and Construction","Aerospace Design and Systems Engineering Elements"]
    ];

    const grid = document.getElementById("courseGrid");
    const totalECEl = document.getElementById("totalEC");
    const progressFill = document.getElementById("progressFill");
    const partialFill = document.getElementById("partialFill");
    const statusText = document.getElementById("statusText");
    const partialText = document.getElementById("partialText");

    courses.forEach((course, i) => {
      const id = `cb-${i}`;
      const row = document.createElement("div");
      row.className = "course";

      row.innerHTML = `
        <div><input type="checkbox" id="${id}" data-ec="${course.ec}" /></div>
        <label for="${id}" class="course-name">${course.name}</label>
        <div class="ec" id="ec-${i}">${course.ec}</div>
        ${[1,2,3,4].map(q => 
          `<div class="quarter ${course.q.includes(q) ? 'active' : ''}">${course.q.includes(q) ? q : ''}</div>`
        ).join('')}
        <div></div>
      `;

      grid.appendChild(row);
    });

    function updateProgress() {
      const checkboxes = grid.querySelectorAll("input[type=checkbox]");
      let confirmedTotal = 0; // ECs that count towards the BSA (modules only count when complete)
      let partialTotal = 0;   // ECs from module-courses where only part of the module is passed

      // Clear previous partial/passed markings
      checkboxes.forEach((cb, i) => {
        const ecEl = document.getElementById(`ec-${i}`);
        // Reset text to just the EC number (remove trailing asterisk)
        ecEl.textContent = courses[i].ec;
        // remove both partial and passed so state is recalculated cleanly
        ecEl.classList.remove("partial", "passed");
        ecEl.title = '';
      });

      // Helper: find module index for quick lookup
      const moduleOf = {};
      modules.forEach((mod, mi) => {
        mod.forEach(name => {
          const idx = courses.findIndex(c => c.name === name);
          if (idx !== -1) moduleOf[idx] = mi;
        });
      });

      // Handle modules (pairs) first
      modules.forEach(mod => {
        const idxA = courses.findIndex(c => c.name === mod[0]);
        const idxB = courses.findIndex(c => c.name === mod[1]);
        if (idxA === -1 || idxB === -1) return; // safety
        const cbA = document.getElementById(`cb-${idxA}`);
        const cbB = document.getElementById(`cb-${idxB}`);
        const ecElA = document.getElementById(`ec-${idxA}`);
        const ecElB = document.getElementById(`ec-${idxB}`);

        if (cbA.checked && cbB.checked) {
          // whole module passed -> both ECs count
          confirmedTotal += Number(cbA.dataset.ec) + Number(cbB.dataset.ec);
          ecElA.classList.add("passed");
          ecElB.classList.add("passed");
        } else if (cbA.checked && !cbB.checked) {
          // partial: show grey stretch and mark this EC with red asterisk + tooltip
          partialTotal += Number(cbA.dataset.ec);
          ecElA.classList.remove("passed");
          ecElA.classList.add("partial");
          ecElA.textContent = `${courses[idxA].ec}*`;
          ecElA.title = `Pass "${courses[idxB].name}" to complete the module.`;
        } else if (!cbA.checked && cbB.checked) {
          partialTotal += Number(cbB.dataset.ec);
          ecElB.classList.remove("passed");
          ecElB.classList.add("partial");
          ecElB.textContent = `${courses[idxB].ec}*`;
          ecElB.title = `Pass "${courses[idxA].name}" to complete the module.`;
        } else {
          // none passed: nothing to do
        }
      });

      // Handle non-module courses
      checkboxes.forEach((cb, i) => {
        if (moduleOf[i] !== undefined) return; // already handled as part of a module
        const ecEl = document.getElementById(`ec-${i}`);
        if (cb.checked) {
          confirmedTotal += Number(cb.dataset.ec);
          ecEl.classList.add("passed");
        } else {
          ecEl.classList.remove("passed");
        }
      });

      // Update displayed confirmed total (modules only count when fully passed)
      totalECEl.textContent = confirmedTotal;

      // Show partial points if any (only visible on non-small screens via CSS)
      if (partialTotal > 0) {
        partialText.textContent = ` (plus ${partialTotal} in unfinished modules)`;
      } else {
        partialText.textContent = '';
      }

      // Update progress fills: confirmed (colored) + partial (grey stretch next to it)
      const confirmedPercent = Math.min((confirmedTotal / TOTAL_EC) * 100, 100);
      let partialPercent = Math.min((partialTotal / TOTAL_EC) * 100, Math.max(0, 100 - confirmedPercent));

      progressFill.style.width = confirmedPercent + "%";
      partialFill.style.left = confirmedPercent + "%";
      partialFill.style.width = partialPercent + "%";

      // Status text logic (confirmed fill is always solid green)
      if (confirmedTotal >= BSA_THRESHOLD) {
        statusText.textContent = "ðŸŽ‰ BSA passed! You have enough ECs.";
        statusText.className = "status pass";
      } else {
        const remaining = BSA_THRESHOLD - confirmedTotal;
        statusText.textContent = `You need ${remaining} more`;
        statusText.className = "status fail";
      }

      // Confirmed area is always solid green
      progressFill.style.background = "#16a34a";

      // Persist checkbox state to cookie
      saveState();
    }

    // Persisted state helpers (cookies)
    function saveState() {
      const checkboxes = grid.querySelectorAll("input[type=checkbox]");
      const checked = [];
      checkboxes.forEach((cb, i) => { if (cb.checked) checked.push(i); });
      try {
        const value = encodeURIComponent(JSON.stringify(checked));
        const expires = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toUTCString();
        document.cookie = `bsa_checked=${value}; expires=${expires}; path=/; samesite=Lax`;
      } catch (e) {
        console.error('Failed to save cookie', e);
      }
    }

    function loadState() {
      const cookie = document.cookie.split('; ').find(c => c.startsWith('bsa_checked='));
      if (!cookie) return;
      try {
        const raw = decodeURIComponent(cookie.split('=')[1] || '[]');
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) {
          arr.forEach(i => {
            const el = document.getElementById(`cb-${i}`);
            if (el) el.checked = true;
          });
        }
      } catch (e) {
        console.error('Failed to load cookie', e);
      }
    }

    grid.addEventListener("change", updateProgress);
    // initialize UI from cookies if present
    loadState();
    updateProgress();
  </script>
</body>
</html>
